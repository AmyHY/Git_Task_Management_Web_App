<!DOCTYPE html>
<html>
<head>
    <title>获取用户授权码</title>
</head>
<body>
    <h1>OAuth Callback Page</h1>
    <p>成功获取用户授权码 🎉</p>
    <!-- <h3>Token Exchange Form</h3>
    <form action="http://localhost:3000/token_exchange" method="post">
        <label for="code">Authorization Code:</label>
        <input type="text" id="code" name="code" required>
        <input type="submit" value="Submit">
    </form> -->
    <script>
        // Function to parse URL parameters
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Extract the authorization code from the URL
        var code = getParameterByName('code');
        
        // Display the authorization code on the page
        var codeElement = document.createElement('p');
        codeElement.textContent = 'Authorization Code: ' + code;
        document.body.appendChild(codeElement);
    </script>

    <!-- Add a button to redirect to pie_chart_page -->
    <button onclick="redirectToPieChart()">获取饼图</button>

    <script>
        // Function to redirect to pie_chart_page
        function redirectToPieChart() {
            // Redirect to the server route that will redirect to pie_chart_page
            window.location.href = '/redirect_to_pie_chart';
        }
    </script>

<script>
    const authorizationCode = getParameterByName('code'); // Code to extract the authorization code
    const tokenExchangeEndpoint = 'http://localhost:3000/token_exchange'; // Replace with your server's URL
  
    // Send the authorization code to the server
    fetch(tokenExchangeEndpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: 'code=' + encodeURIComponent(authorizationCode),
    })
      .then(response => {
        // Handle the response as needed
      })
      .catch(error => {
        console.error('Error during token exchange:', error);
        // Handle errors as needed
      });
  </script>
</body>
</html>
